#!/bin/bash

# Pre-commit hook to enforce modular development workflow
# Prevents modifications to monolithic index.html during migration

# Check if index.html (root) is being modified
if git diff --cached --name-only | grep -q "^index\.html$"; then
    echo ""
    echo "ðŸš« WORKFLOW ENFORCEMENT: index.html modifications blocked"
    echo ""
    echo "The monolithic index.html is now in migration mode."
    echo "All new development should occur in the modular /src/ structure."
    echo ""
    echo "ðŸ“ Use these files instead:"
    echo "  â€¢ /src/index.html - HTML structure"
    echo "  â€¢ /src/main.js - Main entry point"  
    echo "  â€¢ /src/core/ - Core game systems"
    echo "  â€¢ /src/entities/ - Game entities"
    echo "  â€¢ /src/systems/ - Game systems"
    echo ""
    echo "ðŸ”“ Override options:"
    echo "  â€¢ Emergency fixes: git commit --no-verify"
    echo "  â€¢ Migration work: MIGRATION=true git commit"
    echo ""
    echo "ðŸ“– See CLAUDE.md for updated development workflow"
    echo ""
    
    # Check for override flags
    if [ "$MIGRATION" = "true" ]; then
        echo "âœ… Migration override detected - allowing commit"
        exit 0
    fi
    
    # Check commit message for emergency override
    if git log --format=%B -n 1 HEAD 2>/dev/null | grep -q "\[EMERGENCY\]"; then
        echo "ðŸš¨ Emergency override detected - allowing commit"
        exit 0
    fi
    
    exit 1
fi

# Allow all other commits
exit 0