<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Modular Game - Detailed Console</title>
    <style>
        body { 
            font-family: monospace; 
            background: #1a1a2e; 
            color: #eee; 
            margin: 20px;
        }
        .game-container {
            border: 2px solid #0f3460;
            margin: 20px 0;
            max-width: 800px;
        }
        .debug-log {
            background: #000;
            color: #0f0;
            padding: 10px;
            height: 300px;
            overflow-y: auto;
            font-size: 12px;
            border: 1px solid #333;
            margin: 10px 0;
        }
        .controls {
            margin: 10px 0;
        }
        button {
            background: #e94560;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>ðŸš¨ Modular Game Debug Console</h1>
    
    <div class="controls">
        <button onclick="testGameInitialization()">Test Game Initialization</button>
        <button onclick="testAssetLoading()">Test Asset Loading</button>
        <button onclick="testStateManager()">Test State Manager</button>
        <button onclick="testRendering()">Test Rendering</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    
    <div class="debug-log" id="debugLog">
        Debug output will appear here...
    </div>
    
    <div class="game-container">
        <iframe src="http://localhost:3000/src/index.html" width="800" height="400" id="gameFrame"></iframe>
    </div>

    <script>
        let logCount = 0;
        
        function debugLog(message, type = 'info') {
            logCount++;
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('debugLog');
            const color = {
                'info': '#0f0',
                'warn': '#ff0',
                'error': '#f00',
                'success': '#0a0'
            }[type] || '#0f0';
            
            logElement.innerHTML += `<div style="color: ${color}">[${timestamp}] ${logCount}. ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('debugLog').innerHTML = '';
            logCount = 0;
        }
        
        async function testGameInitialization() {
            debugLog('ðŸŽ® Testing game initialization...', 'info');
            
            const frame = document.getElementById('gameFrame');
            
            try {
                // Wait a bit for iframe to load
                setTimeout(() => {
                    try {
                        const frameWindow = frame.contentWindow;
                        const frameDocument = frame.contentDocument || frameWindow.document;
                        
                        debugLog(`ðŸ“„ Iframe document loaded: ${!!frameDocument}`, 'info');
                        debugLog(`ðŸŽ¯ Canvas exists: ${!!frameDocument.getElementById('gameCanvas')}`, 'info');
                        debugLog(`ðŸŽ® Game instance exists: ${!!frameWindow.game}`, frameWindow.game ? 'success' : 'error');
                        
                        if (frameWindow.game) {
                            debugLog(`ðŸ”§ Game initialized: ${frameWindow.game.initialized}`, frameWindow.game.initialized ? 'success' : 'error');
                            debugLog(`ðŸŽ¬ Game loop running: ${frameWindow.game.gameLoop?.isRunning()}`, frameWindow.game.gameLoop?.isRunning() ? 'success' : 'error');
                        }
                        
                        // Check console errors
                        debugLog('ðŸ“‹ Check the browser dev tools console for JavaScript errors!', 'warn');
                        
                    } catch (e) {
                        debugLog(`âŒ Error accessing iframe: ${e.message}`, 'error');
                    }
                }, 2000);
                
            } catch (error) {
                debugLog(`âŒ Initialization test error: ${error.message}`, 'error');
            }
        }
        
        async function testAssetLoading() {
            debugLog('ðŸŽ¨ Testing asset loading...', 'info');
            
            // Test asset URLs directly
            const assetUrls = [
                'http://localhost:3000/pet_food_bowl.png',
                'http://localhost:3000/pet_water_bowl.png',
                'http://localhost:3000/bowie_cat_3x3.png'
            ];
            
            for (const url of assetUrls) {
                try {
                    const response = await fetch(url);
                    debugLog(`ðŸ“¦ ${url.split('/').pop()}: ${response.ok ? 'âœ… OK' : 'âŒ FAIL'} (${response.status})`, response.ok ? 'success' : 'error');
                } catch (error) {
                    debugLog(`ðŸ“¦ ${url.split('/').pop()}: âŒ Network error: ${error.message}`, 'error');
                }
            }
        }
        
        async function testStateManager() {
            debugLog('ðŸ—‚ï¸ Testing state manager...', 'info');
            
            const frame = document.getElementById('gameFrame');
            
            setTimeout(() => {
                try {
                    const frameWindow = frame.contentWindow;
                    const stateManager = frameWindow.stateManager;
                    
                    if (stateManager) {
                        debugLog(`ðŸ—‚ï¸ State Manager exists: âœ…`, 'success');
                        debugLog(`ðŸ“Š Current level: ${stateManager.get('game.currentLevel')}`, 'info');
                        debugLog(`ðŸ‘¤ Player X: ${stateManager.get('runtime.player.x')}`, 'info');
                        debugLog(`ðŸ‘¤ Player Y: ${stateManager.get('runtime.player.y')}`, 'info');
                        debugLog(`ðŸŽ¥ Camera X: ${stateManager.get('runtime.camera.x')}`, 'info');
                    } else {
                        debugLog(`ðŸ—‚ï¸ State Manager not found: âŒ`, 'error');
                    }
                } catch (error) {
                    debugLog(`âŒ State manager test error: ${error.message}`, 'error');
                }
            }, 2000);
        }
        
        async function testRendering() {
            debugLog('ðŸŽ¨ Testing rendering...', 'info');
            
            const frame = document.getElementById('gameFrame');
            
            setTimeout(() => {
                try {
                    const frameDocument = frame.contentDocument || frame.contentWindow.document;
                    const canvas = frameDocument.getElementById('gameCanvas');
                    
                    if (canvas) {
                        debugLog(`ðŸŽ¨ Canvas dimensions: ${canvas.width}x${canvas.height}`, 'info');
                        debugLog(`ðŸ–¼ï¸ Canvas context: ${!!canvas.getContext('2d')}`, 'info');
                        
                        // Try to capture canvas data
                        try {
                            const ctx = canvas.getContext('2d');
                            const imageData = ctx.getImageData(0, 0, 10, 10);
                            const hasNonTransparentPixels = imageData.data.some((value, index) => 
                                index % 4 === 3 && value > 0 // Check alpha channel
                            );
                            debugLog(`ðŸ–¼ï¸ Canvas has content: ${hasNonTransparentPixels ? 'âœ… YES' : 'âŒ NO (empty/transparent)'}`, hasNonTransparentPixels ? 'success' : 'error');
                        } catch (e) {
                            debugLog(`ðŸ–¼ï¸ Cannot read canvas content: ${e.message}`, 'warn');
                        }
                    } else {
                        debugLog(`ðŸŽ¨ Canvas not found: âŒ`, 'error');
                    }
                } catch (error) {
                    debugLog(`âŒ Rendering test error: ${error.message}`, 'error');
                }
            }, 3000);
        }
        
        // Auto-run initial tests
        setTimeout(() => {
            debugLog('ðŸš€ Starting automated debug tests...', 'info');
            testAssetLoading();
            testGameInitialization();
        }, 1000);
    </script>
</body>
</html>